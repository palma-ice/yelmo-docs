<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>Running hysteresis experiments for Antarctica - Yelmo-docs</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Running hysteresis experiments for Antarctica";
        var mkdocs_page_input_path = "running-hysteresis.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> Yelmo-docs
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="..">Home</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../getting-started/">Getting started</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../dependencies/">Dependencies</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../parameters/">Parameters</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../example-programs/">Examples</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../running-with-yelmox/">YelmoX</a>
                </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">Yelmo-docs</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">Running hysteresis experiments for Antarctica</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="running-hysteresis-experiments-for-antarctica">Running hysteresis experiments for Antarctica</h1>
<p>For now, we will:</p>
<ul>
<li>Use optimized basal friction.</li>
<li>Spinup with a constant present-day climate based on the ISMIP6 protocol.</li>
</ul>
<p>To run <code>yelmox</code> with this setup, we need the <code>hyst-2021</code> branches:</p>
<pre><code class="language-bash">cd yelmox
git checkout hyst-2021

cd yelmo
git checkout hyst-2021

# Reconfigure
python3 config.py config/snowball_gfortran
cd ..
python3 config.py config/snowball_gfortran

# If not done already, link to ice_data
ln -s /media/Data/ice_data ice_data
</code></pre>
<p>We will run with the ISMIP6 standard YelmoX program, so compile:</p>
<pre><code class="language-bash">make clean
make yelmox_ismip6
</code></pre>
<p>The hysteresis runs can be done in two steps:</p>
<ol>
<li>First, generate a spun-up simulation with optimized basal friction.</li>
<li>Restart from the optimized, spun-up state and continue with transient forcing from the
hysteresis module.</li>
</ol>
<h2 id="step-1-spinup">Step 1: spinup</h2>
<p>The spinup simulation runs for 30.000 years, by default. For the first <code>opt_L21.rel_time1=5e3</code> years, the shelves and grounding line are relaxed (tightly) to the present-day reference state, while the optimization of the basal friction field <code>cf_ref</code> is active. Next between <code>opt_L21.rel_time1=5e3</code> kyr and <code>opt_L21.rel_time2=10e3</code> years, the relaxation timescale is slowly increased from <code>opt_L21.rel_tau1=10</code> yrs to <code>opt_L21.rel_tau2=1000</code> yrs, to slowly allow the ice sheet more freedom to adjust its state. Basal optimization is further optimized during this time period. After <code>opt_L21.rel_time2=10e3</code> years, the relation is disabled and the ice sheet if fully prognostic. The simulation is further run until the end with continual optimization adjustments to <code>cf_ref</code>, although these are usually minor after the initial spinup period.</p>
<p>To run a spinup simulation as above, use the following command:</p>
<pre><code class="language-bash"># First run spinup simulation
# (steady-state present day boundary conditions)
./runme -r -e ismip6 -n par/yelmo_ismip6_Antarctica.nml -o output/hyst/spinup01 -p ctrl.run_step=&quot;spinup_ismip6&quot; opt_L21.cf_min=1e-3 ytopo.kt=0.10e-2 tf_corr_ant.ronne=0.25 tf_corr_ant.ross=0.2 tf_corr_ant.pine=-0.5
</code></pre>
<p>Or an ensemble to test different parameters too:</p>
<pre><code class="language-bash">fldr=output/hyst/spinup02
jobrun ./runme -r -e ismip6 -n par/yelmo_ismip6_Antarctica.nml -- -o ${fldr} -p ctrl.run_step=&quot;spinup_ismip6&quot; opt_L21.cf_min=1e-3 ytopo.kt=0.10e-2,0.20e-2,0.30e-2,0.40e-2 tf_corr_ant.ronne=0.0,0.25 tf_corr_ant.ross=0.0,0.2 tf_corr_ant.pine=-0.5,0.0
</code></pre>
<p>To make the spinup run for a longer time, like 50 kyr, set <code>ctrl.time_end=50e3</code>.</p>
<p>If you already have a spinup simulation available, you can skip that step.
Alternatively, you can specify one that is ready on <code>snowball</code>:</p>
<pre><code class="language-bash">yelmo.restart=/home/robinson/abumip-2021/yelmox/output/ismip6/spinup11/1/yelmo_restart.nc
</code></pre>
<h2 id="step-2-transient-simulations">Step 2: transient simulations</h2>
<p>To run transient simulations the <code>run_step</code> should be specified as <code>ctrl.run_step="hysteresis_proj"</code>. Typically model parameters should be defined to be equivalent to those used by the restart simulation. The time control parameters of the simulation are defined in the parameter section <code>&amp;hysteresis_proj</code>. Parameters associated with the hysteresis module can be changed in the <code>&amp;hyster</code> section.</p>
<p>To be consistent with the restart file above, the following reference parameter values should be set in the parameter file (or at the command line, if used as part of the ensemble):</p>
<pre><code class="language-bash">ctrl.run_step=&quot;hysteresis_proj&quot;
tf_cor.name=&quot;dT_nl&quot;
marine_shelf.gamma_quad_nl=14500
yelmo.restart=/home/robinson/abumip-2021/yelmox/output/ismip6/spinup11/1/yelmo_restart.nc
tf_corr_ant.ronne=0.25
tf_corr_ant.ross=0.2 
tf_corr_ant.pine=-0.5

# For setting output frequency
hysteresis_proj.dt2D_out=5e3 
hysteresis.dt2D_small_out=100
</code></pre>
<p>Example transient simulation of <code>hysteresis_proj.time_end=500</code> years, with ramp forcing via the <code>hyster</code> module with 100 years of constant forcing, followed by a ramp over 250 years from an anomaly of 0 degC to 5 degC:</p>
<pre><code class="language-bash">./runme -r -e ismip6 -n par/yelmo_ismip6_Antarctica.nml -o output/hyst/test1 -p ytopo.kt=0.001 \
hyster.method=&quot;ramp&quot; hyster.dt_init=100 hyster.dt_ramp=250 hyster.f_min=0 hyster.f_max=5
</code></pre>
<p>Example transient simulation using Adaptive Quasi-Equilibrium Forcing (AQEF) with no lead-in time:</p>
<pre><code class="language-bash">./runme -r -e ismip6 -n par/yelmo_ismip6_Antarctica.nml -o output/hyst/test2 -p ytopo.kt=0.001 \
hyster.method=&quot;PI42&quot; hyster.dt_init=0 hyster.f_min=0 hyster.f_max=5
</code></pre>
<p>Or simply further constant forcing of a control run by setting <code>hyster.method="const"</code>.</p>
<p>You can add white noise (Normal distribution) to your forcing by setting the standard deviation greater than zero: <code>hyster.sigma=1.0</code>.</p>
              
            </div>
          </div><footer>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
