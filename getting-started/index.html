<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../img/favicon.ico">
        <title>Getting started - Yelmo-docs</title>
        <link href="../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../css/font-awesome.min.css" rel="stylesheet">
        <link href="../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
        <![endif]-->

        <script src="../js/jquery-1.10.2.min.js" defer></script>
        <script src="../js/bootstrap-3.0.3.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script> 
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
            <div class="container">

                <!-- Collapsed navigation -->
                <div class="navbar-header">
                    <!-- Expander button -->
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <a class="navbar-brand" href="..">Yelmo-docs</a>
                </div>

                <!-- Expanded navigation -->
                <div class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li >
                                <a href="..">Home</a>
                            </li>
                            <li class="active">
                                <a href="./">Getting started</a>
                            </li>
                            <li >
                                <a href="../dependencies/">Dependencies</a>
                            </li>
                            <li >
                                <a href="../parameters/">Parameters</a>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav navbar-right">
                        <li>
                            <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li >
                                <a rel="next" href="..">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li >
                                <a rel="prev" href="../dependencies/">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
                <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
        <li class="main active"><a href="#getting-started">Getting started</a></li>
            <li><a href="#dependencies">Dependencies</a></li>
            <li><a href="#directory-structure">Directory structure</a></li>
            <li><a href="#usage">Usage</a></li>
    </ul>
</div></div>
                <div class="col-md-9" role="main">

<h1 id="getting-started">Getting started</h1>
<p>This file describes the basic information and steps needed to get <strong>Yelmo</strong>
running.</p>
<h2 id="dependencies">Dependencies</h2>
<ul>
<li>NetCDF library (preferably version 4.0 or higher)</li>
<li>LIS: <a href="http://www.ssisc.org/lis/">Library of Iterative Solvers for Linear Systems</a></li>
</ul>
<p>See: <a href="https://palma-ice.github.io/yelmo-docs/dependencies/">Dependencies</a></p>
<p>OPTIONAL:
- Python 3.x, which is only needed for automatic configuration of the Makefile
and the use of the script <code>run_yelmo.py</code> for job preparation and submission.</p>
<h2 id="directory-structure">Directory structure</h2>
<pre><code class="fortran">    config/
        Configuration files for compilation on different systems.
    input/
        Location of any input data needed by the model.
    libs/
        Auxiliary libraries nesecessary for running the model.
    libyelmo/
        Folder containing all compiled files in a standard way with
        lib/, include/ and bin/ folders.
    output/
        Default location for model output.
    par/ 
        Default parameter files that manage the model configuration.
    src/
        Source code for Yelmo.
    tests/ 
        Source code and analysis scripts for specific model benchmarks and tests.
</code></pre>

<h2 id="usage">Usage</h2>
<p><strong>Yelmo</strong> is hosted in a git repository. Follow the steps below to
obtain the code, compile it and run a test simulation.</p>
<h3 id="1-get-the-code">1. Get the code.</h3>
<p>Clone the repository from <a href="https://github.com/palma-ice/yelmo">https://github.com/palma-ice/yelmo</a>:</p>
<pre><code>git clone git@github.com:palma-ice/yelmo.git $YELMOROOT
cd $YELMOROOT 
</code></pre>

<p>where <code>$YELMOROOT</code> is the installation directory.</p>
<p>If you plan to make changes to the code, it is wise to check out a new branch:</p>
<pre><code>git checkout -b user-dev
</code></pre>

<p>You should now be working on the branch <code>user-dev</code>.</p>
<h3 id="2-create-the-system-specific-makefile">2. Create the system-specific Makefile.</h3>
<p>To compile Yelmo, you need to generate a Makefile that is appropriate for your system. In the folder <code>config</code>, you need to specify a configuration file that defines the compiler and flags, including definition of the paths to the <code>NetCDF</code> and <code>LIS</code> libraries. You can use another file in the config folder as a template, e.g.,</p>
<pre><code>cd config
cp pik_ifort myhost_mycompiler
</code></pre>

<p>then modify the file <code>myhost_mycompiler</code> to match your paths. Back in <code>$YELMOROOT</code>, you can then generate your Makefile with the provided python configuration script:</p>
<pre><code>cd $YELMOROOT
python config.py config/myhost_mycompiler
</code></pre>

<p>The result should be a Makefile in <code>$YELMOROOT</code> that is ready for use. </p>
<h3 id="3-compile-the-code">3. Compile the code.</h3>
<p>Now you are ready to compile Yelmo as a static library:</p>
<pre><code>make clean    # This step is very important to avoid errors!!
make yelmo-static [debug=1]
</code></pre>

<p>This will compile all of the Yelmo modules and libraries (as defined in <code>config/Makefile_yelmo.mk</code>),
and link them in a static library. All compiled files can be found in the folder <code>libyelmo/</code>. </p>
<p>Once the static library has been compiled, it can be used inside of external Fortran programs and modules
via the statement <code>use yelmo</code>. 
To include/link yelmo-static during compilation of another program, its location must be defined:</p>
<pre><code>INC_YELMO = -I${YELMOROOT}/include
LIB_YELMO = -L${YELMOROOT}/include -lyelmo
</code></pre>

<p>Alternatively, several test programs exist in the folder <code>tests/</code> to run Yelmo 
as a stand-alone ice sheet.
For example, it's possible to run different EISMINT benchmarks, MISMIP benchmarks and the
ISIMIP6 INITMIP simulation for Greenland, respectively:</p>
<pre><code>make benchmarks    # compiles the program `libyelmo/bin/yelmo_benchmarks.x`
make mismip        # compiles the program `libyelmo/bin/yelmo_mismip.x`
make initmip       # compiles the program `libyelmo/bin/yelmo_initmip.x`
</code></pre>

<p>The Makefile additionally allows you to specify debugging compiler flags with the option <code>debug=1</code>, in case you need to debug the code (e.g., <code>make benchmarks debug=1</code>). Using this option, the code will run much slower, so this option is not recommended unless necessary.</p>
<h3 id="4-run-the-model">4. Run the model.</h3>
<p>Once an executable has been created, you can run the model. This can be
achieved via the included Python job submission script <code>run_yelmo.py</code>. The following steps
are carried out via the script:</p>
<ol>
<li>The output directory is created.</li>
<li>The executable is copied to the output directory</li>
<li>The relevant parameter files are copied to the output directory.</li>
<li>Links to the input data paths (<code>input</code> and <code>ice_data</code>) are created in the output directory. (Note <code>ice_data</code> is typically linked to an external data repository, and is not necessary.)</li>
<li>The executable is run from the output directory, either as a background process or it is submitted to the queue (the script currently supports <code>qsubmit</code> and <code>sbatch</code> commands).</li>
</ol>
<p>To run a benchmark simulation, for example, use the following command:</p>
<pre><code>python run_yelmo.py -r -e benchmarks output/test par/yelmo_EISMINT.nml 
</code></pre>

<p>where the option <code>-r</code> implies that the model should be run as a background process. If this is omitted, then the output directory will be populated, but no executable will be run, while <code>-s</code> instead will submit the simulation to cluster queue system instead of running in the background. The option <code>-e</code> lets you specify the executable. For some standard cases, shortcuts have been created:</p>
<pre><code>benchmarks = libyelmo/bin/yelmo_benchmarks.x 
mismip     = libyelmo/bin/yemo_mismip.x 
initmip    = libyelmo/bin/yelmo_initmip.x 
</code></pre>

<p>The last two mandatory arguments are always the output/run directory and the parameter file to be used for this simulation. In the case of the above simulation, the output directory is defined as <code>output/test</code>, where all model parameters (loaded from the file <code>par/yelmo_EISMINT.nml</code>) and model output can be found. </p>
<!--
Additional powerful job submission functionality is available by using the Python `runner` tool. The `job run` command of the `runner` package allows you to change parameter values at the command line and perform large ensembles. For example, you can run an ensemble of two simulations as above but with different grid resolutions using:

<pre><code>job run -f -o output/test -p eismint.dx=25.0,50.0 -- python run_yelmo.py -s -x -e benchmarks {} par/yelmo_EISMINT.nml
</code></pre>

where `-f` means execute the command without confirmation, `-o` is the parent ensemble directory, `-p` is the argument to allow you to list parameters to modify and `eismint.dx=25.0,50.0` specifies that the parameter `dx` in the namelist group `eismint` should be given a value of `25.0` in one simulation and `50.0` in the second simulation. This command will modify the specified parameters found in the parameter file `par_yelmo_EISMINT.nml` and then run the simulation from the run directory `output/test/{}` where `{}` is the name of the directory corresponding to that parameter combination. Using the option `-o` means that the specific run directory name is simply the number of the simulation, so the run directory for the above command would be `output/test/0`. Using the option `-a` means that the run directory will have a name corresponding to the parameter combination specified. Also note that for `run_yelmo.py` to work properly when called by `job run`, the additional option `-x` must be specified.

The list of parameter choices corresponding to each directory can be found in the file:

<pre><code>output/test/params.txt
</code></pre>


More information about running jobs can be found in the help of `run_yelmo.py` and `runner`:


<pre><code>./run_yelmo.py -h
job -h 
job run -h 
</code></pre>

--></div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>
            var base_url = "..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../js/base.js" defer></script>
        <script src="../search/main.js" defer></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Search</h4>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form role="form">
                    <div class="form-group">
                        <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="Keyboard Shortcuts Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Keyboard Shortcuts</h4>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
