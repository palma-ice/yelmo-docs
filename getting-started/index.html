<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../img/favicon.ico">
        <title>Getting started - Yelmo-docs</title>
        <link href="../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../css/font-awesome.min.css" rel="stylesheet">
        <link href="../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
        <![endif]-->

        <script src="../js/jquery-1.10.2.min.js" defer></script>
        <script src="../js/bootstrap-3.0.3.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script> 
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
            <div class="container">

                <!-- Collapsed navigation -->
                <div class="navbar-header">
                    <!-- Expander button -->
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <a class="navbar-brand" href="..">Yelmo-docs</a>
                </div>

                <!-- Expanded navigation -->
                <div class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li >
                                <a href="..">Home</a>
                            </li>
                            <li class="active">
                                <a href="./">Getting started</a>
                            </li>
                            <li >
                                <a href="../dependencies/">Dependencies</a>
                            </li>
                            <li >
                                <a href="../parameters/">Parameters</a>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav navbar-right">
                        <li>
                            <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li >
                                <a rel="next" href="..">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li >
                                <a rel="prev" href="../dependencies/">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
                <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
        <li class="main active"><a href="#dependencies">Dependencies</a></li>
        <li class="main "><a href="#directory-structure">Directory structure</a></li>
        <li class="main "><a href="#usage">Usage</a></li>
            <li><a href="#1-get-the-code">1. Get the code.</a></li>
            <li><a href="#2-housekeeping">2. Housekeeping.</a></li>
            <li><a href="#3-compile-the-code">3. Compile the code.</a></li>
            <li><a href="#4-run-the-model">4. Run the model.</a></li>
            <li><a href="#troubleshooting">Troubleshooting</a></li>
    </ul>
</div></div>
                <div class="col-md-9" role="main">

<p>This file describes the basic steps needed to get <strong>Yelmo</strong>
running.</p>
<h2 id="dependencies">Dependencies</h2>
<ul>
<li>NetCDF library (preferably version 4.0 or higher)</li>
<li>LIS: <a href="http://www.ssisc.org/lis/">Library of Iterative Solvers for Linear Systems</a></li>
<li><a href="https://github.com/alex-robinson/coordinates" title="alex-robinson/coordinates">Coordinates library</a></li>
</ul>
<p>OPTIONAL:
- Python 2.7.x or 3.x, which is only needed for automation of configuration of Makefile
and the use of the <code>run_yelmo.py</code> script for job preparation and submission.
- <a href="https://gitlab.pik-potsdam.de/greenrise/runner" title="runner library">Python library <code>runner</code></a>, which extends the <code>run_yelmo.py</code> functionality to facilitate running ensembles of simulations.
- Access to the <code>ice_data</code> repository of pre-processed
input data for the model on different domains (North, Eurasia, Greenland, Antarctica)</p>
<h2 id="directory-structure">Directory structure</h2>
<pre><code class="fortran">    config/
        Configuration files for compilation on different systems.
    docs/
        Model documentation.
    input/
        Location of any input data needed by the model.
    libs/
        Auxiliary libraries nesecessary for running the model.
    libyelmo/
        Folder containing all compiled files in a standard way with
        lib/, include/ and bin/ folders.
    output/
        Default location for model output.
    par/ 
        Default parameter files that manage the model configuration.
    src/
        Source code for Yelmo.
    tests/ 
        Source code and analysis scripts for specific model benchmarks and tests.
</code></pre>

<h2 id="usage">Usage</h2>
<p><strong>Yelmo</strong> is hosted in a git repository. Follow the steps below to
obtain the code, compile it and run a test simulation.</p>
<h3 id="1-get-the-code">1. Get the code.</h3>
<p>Clone the repository, check out a new branch and make sure it is linked 'upstream' to the same branch in the central repository:</p>
<pre><code>git clone user@airara.fis.ucm.es:/palma/repos/yelmo.git yelmo
git checkout -b user-dev
git push -u origin user-dev
</code></pre>

<p>You should now be working on the branch <code>user-dev</code>.</p>
<h3 id="2-housekeeping">2. Housekeeping.</h3>
<ul>
<li>You need to generate a symbolic link to the input (2D/3D/+) data folder that the model uses (typically the location of the <code>ice_data</code> repository), e.g.,</li>
</ul>
<pre><code>ln -s PATH/TO/ice_data ice_data
</code></pre>

<ul>
<li>You need to generate the Makefile that is appropriate for your system. In the folder config, you need to specify a configuration file with the name of your system that contains the paths to the <code>NetCDF</code>, <code>LIS</code> and <code>coordinates</code> libraries. See others in the config folder for a template, e.g.,</li>
</ul>
<pre><code>cd config
cp eolo your_system
</code></pre>

<p>then modify the file <code>your_system</code> to match your paths. This file should have the name that is output from your system when you run the bash command <code>hostname</code>. Back in the main <code>yelmo</code> directory, you can then generate your Makefile with the provided python configuration script:</p>
<pre><code>cd ..
python config.py
</code></pre>

<h3 id="3-compile-the-code">3. Compile the code.</h3>
<p>Now you are ready to compile the <strong>Yelmo</strong> program you desire (eg, <code>yelmo_benchmarks</code>) :</p>
<pre><code>make clean    *This step is very important to avoid errors!!
make yelmo_benchmarks [debug=1]
</code></pre>

<p>(or other program <code>yelmo_test</code>, <code>yelmo_mismip</code>, <code>yelmo_stommel</code> or <code>yelmo_optbeta</code>). The <code>debug=1</code> option allows you to compile with debugging compiler options enabled, in case you need to debug the code. Using this option, the code will run much slower, so this option is not recommended for real simulations.</p>
<h3 id="4-run-the-model">4. Run the model.</h3>
<p>Once the executable has been created, you can run the model. This can be
achieved via a Python job submission script <code>run_yelmo.py</code>. The following steps
are carried out via the script:</p>
<ol>
<li>The output directory is created.</li>
<li>The executable is copied to the output directory</li>
<li>The parameter files are copied to the output directory.</li>
<li>Links to the input data paths (<code>input</code> and <code>ice_data</code>) are created in the output directory.</li>
<li>The executable is run from the output directory, either as a background process or it is submitted to the queue (currently supports <code>qsubmit</code> and <code>sbatch</code> commands).</li>
</ol>
<p>To run a test simulation on a cluster using the executable <code>yelmo_benchmarks.x</code>, use the following command:</p>
<pre><code>./run_yelmo.py -s -e benchmarks output/test par/yelmo_EISMINT.nml 
</code></pre>

<p>where <code>-s</code> implies submission to the cluster queue, and <code>-e</code> lets you specify the executable. For some standard cases, shortcuts have been created:</p>
<pre><code>benchmarks = libyelmo/bin/yelmo_benchmarks.x 
test       = libyelmo/bin/yelmo_test.x 
mismip     = libyelmo/bin/yemo_mismip.x 
</code></pre>

<p>The last two mandatory arguments are always the output/run directory and the parameter file to be used for this simulation. </p>
<p>Additional powerful job submission functionality is available by using the Python <code>runner</code> tool. The <code>job run</code> command of the <code>runner</code> package allows you to change parameter values at the command line and perform large ensembles. For example, you can run an ensemble of two simulations as above but with different grid resolutions using:</p>
<pre><code>job run -f -o output/test -p eismint.dx=25.0,50.0 -- python run_yelmo.py -s -x -e benchmarks {} par/yelmo_EISMINT.nml
</code></pre>

<p>where <code>-f</code> means execute the command without confirmation, <code>-o</code> is the parent ensemble directory, <code>-p</code> is the argument to allow you to list parameters to modify and <code>eismint.dx=25.0,50.0</code> specifies that the parameter <code>dx</code> in the namelist group <code>eismint</code> should be given a value of <code>25.0</code> in one simulation and <code>50.0</code> in the second simulation. This command will modify the specified parameters found in the parameter file <code>par_yelmo_EISMINT.nml</code> and then run the simulation from the run directory <code>output/test/{}</code> where <code>{}</code> is the name of the directory corresponding to that parameter combination. Using the option <code>-o</code> means that the specific run directory name is simply the number of the simulation, so the run directory for the above command would be <code>output/test/0</code>. Using the option <code>-a</code> means that the run directory will have a name corresponding to the parameter combination specified. Also note that for <code>run_yelmo.py</code> to work properly when called by <code>job run</code>, the additional option <code>-x</code> must be specified.</p>
<p>The list of parameter choices corresponding to each directory can be found in the file:</p>
<pre><code>output/test/params.txt
</code></pre>

<p>More information about running jobs can be found in the help of <code>run_yelmo.py</code> and <code>runner</code>:</p>
<pre><code>./run_yelmo.py -h
job -h 
job run -h 
</code></pre>

<h3 id="troubleshooting">Troubleshooting</h3>
<p><code>Runtime error: liblis.so.0 not found</code>
It may be necessary to export the LIS lib path to the linker, in order to avoid a runtime error. This can be achieved by including the following lines in the <code>.bash_profile</code> file:</p>
<pre><code># lis library paths 
LD_LIBRARY_PATH=/home/fispalma25/apps/lis/lis/lib:$LD_LIBRARY_PATH
export LD_LIBRARY_PATH
</code></pre></div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>
            var base_url = "..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../js/base.js" defer></script>
        <script src="../search/main.js" defer></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Search</h4>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form role="form">
                    <div class="form-group">
                        <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="Keyboard Shortcuts Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Keyboard Shortcuts</h4>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
