<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  
  <link rel="shortcut icon" href="../img/favicon.ico">
  <title>Getting started - Yelmo-docs</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700" />

  <link rel="stylesheet" href="../css/theme.css" />
  <link rel="stylesheet" href="../css/theme_extra.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css" />
  
  <script>
    // Current page data
    var mkdocs_page_name = "Getting started";
    var mkdocs_page_input_path = "getting-started.md";
    var mkdocs_page_url = null;
  </script>
  
  <script src="../js/jquery-2.1.1.min.js" defer></script>
  <script src="../js/modernizr-2.8.3.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> Yelmo-docs</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="..">Home</a>
                    </li>
                </ul>
                <ul class="current">
                    <li class="toctree-l1 current"><a class="reference internal current" href="./">Getting started</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#super-quick-start">Super-quick start</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#dependencies">Dependencies</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#directory-structure">Directory structure</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#usage">Usage</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#1-get-the-code">1. Get the code.</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#2-create-the-system-specific-makefile">2. Create the system-specific Makefile.</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#alternative-configuration-quickstart-with-docker-and-vs-code">Alternative configuration - quickstart with Docker and VS Code</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#3-compile-the-code">3. Compile the code.</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#4-run-the-model">4. Run the model.</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#test-cases">Test cases</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#1-eismint1-moving-margin-experiment">1. EISMINT1 moving margin experiment</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#2-eismint2-expa">2. EISMINT2 EXPA</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#3-eismint2-expf">3. EISMINT2 EXPF</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#4-mismip-rf">4. MISMIP RF</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#5-age-profile-experiments">5. Age profile experiments</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#6-antarctica-present-day-and-glacial-simulations">6. Antarctica present-day and glacial simulations</a>
    </li>
        </ul>
    </li>
    </ul>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../dependencies/">Dependencies</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../parameters/">Parameters</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../example-programs/">Examples</a>
                    </li>
                </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">Yelmo-docs</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
    
    <li>Getting started</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="getting-started">Getting started</h1>
<p>Here you can find the basic information and steps needed to get <strong>Yelmo</strong> running.</p>
<h2 id="super-quick-start">Super-quick start</h2>
<p>A summary of commands to get started is given below. For more detailed information see subsequent sections.</p>
<pre><code># Clone repository
git clone git@github.com:palma-ice/yelmo.git

# Enter directory and run configuration script
cd yelmo
python config.py config/pik_ifort 

# Compile the benchmarks program
make clean 
make benchmarks 

# Run a test simulation of the EISMINT1-moving experiment
./runylmo -r -e benchmarks -o output/eismint1-moving -n par-gmd/yelmo_EISMINT-moving.nml

# Compile the initmip program and run a simulation of Antarctica
make initmip 
./runylmo -r -e initmip -o output/ant-pd -n par/yelmo_initmip.nml -p ctrl.clim_nm=&quot;clim_pd&quot;
</code></pre>
<h2 id="dependencies">Dependencies</h2>
<p>See: <a href="https://palma-ice.github.io/yelmo-docs/dependencies/">Dependencies</a> for installation tips.</p>
<ul>
<li>NetCDF library (preferably version 4.0 or higher)</li>
<li>LIS: <a href="http://www.ssisc.org/lis/">Library of Iterative Solvers for Linear Systems</a></li>
<li>[Optional] Python 3.x, which is only needed for automatic configuration of the Makefile and the use of the script <code>runylmo</code> for job preparation and submission.</li>
<li>[Optional] 'runner' Python library: <a href="https://github.com/alex-robinson/runner">https://github.com/alex-robinson/runner</a>. Used for changing parameters at the command line using <code>runylmo</code>, and for running ensembles. </li>
</ul>
<h2 id="directory-structure">Directory structure</h2>
<pre><code class="language-fortran">    config/
        Configuration files for compilation on different systems.
    input/
        Location of any input data needed by the model.
    libs/
        Auxiliary libraries nesecessary for running the model.
    libyelmo/
        Folder containing all compiled files in a standard way with
        lib/, include/ and bin/ folders.
    output/
        Default location for model output.
    par/
        Default parameter files that manage the model configuration.
    src/
        Source code for Yelmo.
    tests/
        Source code and analysis scripts for specific model benchmarks and tests.
</code></pre>
<h2 id="usage">Usage</h2>
<p>Follow the steps below to (1) obtain the code, (2) configure the Makefile for your system,
(3) compile the Yelmo static library and an executable program and (4) run a test simulation.</p>
<h3 id="1-get-the-code">1. Get the code.</h3>
<p>Clone the repository from <a href="https://github.com/palma-ice/yelmo">https://github.com/palma-ice/yelmo</a>:</p>
<pre><code>git clone git@github.com:palma-ice/yelmo.git $YELMOROOT
cd $YELMOROOT
</code></pre>
<p>where <code>$YELMOROOT</code> is the installation directory.</p>
<p>If you plan to make changes to the code, it is wise to check out a new branch:</p>
<pre><code>git checkout -b user-dev
</code></pre>
<p>You should now be working on the branch <code>user-dev</code>.</p>
<h3 id="2-create-the-system-specific-makefile">2. Create the system-specific Makefile.</h3>
<p>To compile Yelmo, you need to generate a Makefile that is appropriate for your system. In the folder <code>config</code>, you need to specify a configuration file that defines the compiler and flags, including definition of the paths to the <code>NetCDF</code> and <code>LIS</code> libraries. You can use another file in the config folder as a template, e.g.,</p>
<pre><code>cd config
cp pik_ifort myhost_mycompiler
</code></pre>
<p>then modify the file <code>myhost_mycompiler</code> to match your paths. Back in <code>$YELMOROOT</code>, you can then generate your Makefile with the provided python configuration script:</p>
<pre><code>cd $YELMOROOT
python config.py config/myhost_mycompiler
</code></pre>
<p>The result should be a Makefile in <code>$YELMOROOT</code> that is ready for use.</p>
<h4 id="alternative-configuration-quickstart-with-docker-and-vs-code">Alternative configuration - quickstart with Docker and VS Code</h4>
<p>Instead of a manual install, one way to get up and running quickly with Yelmo is with VS Code and Docker. It works on any plattform and uses a Linux based container. You don't need to know Docker or VS Code to get started. Just install the following:</p>
<ol>
<li><a href="https://docs.docker.com/engine/install/">Docker</a></li>
<li><a href="https://code.visualstudio.com">VS Code</a> </li>
<li><a href="https://marketplace.visualstudio.com/items?itemName=ms-vscode-remote.vscode-remote-extensionpack">install the remote development extension</a></li>
</ol>
<p>Then make sure that Docker is running and start VS Code. 
Open the folder with the Yelmo code. Say Yes, when VS Code asks you if you want to open it in the container.</p>
<p>Now you can directly go to step 3 below, just make sure that you use the terminal in VS Code.</p>
<h3 id="3-compile-the-code">3. Compile the code.</h3>
<p>Now you are ready to compile Yelmo as a static library:</p>
<pre><code>make clean    # This step is very important to avoid errors!!
make yelmo-static [debug=1]
</code></pre>
<p>This will compile all of the Yelmo modules and libraries (as defined in <code>config/Makefile_yelmo.mk</code>),
and link them in a static library. All compiled files can be found in the folder <code>libyelmo/</code>.</p>
<p>Once the static library has been compiled, it can be used inside of external Fortran programs and modules
via the statement <code>use yelmo</code>.
To include/link yelmo-static during compilation of another program, its location must be defined:</p>
<pre><code>INC_YELMO = -I${YELMOROOT}/include
LIB_YELMO = -L${YELMOROOT}/include -lyelmo
</code></pre>
<p>Alternatively, several test programs exist in the folder <code>tests/</code> to run Yelmo
as a stand-alone ice sheet.
For example, it's possible to run different EISMINT benchmarks, MISMIP benchmarks and the
ISIMIP6 INITMIP simulation for Greenland, respectively:</p>
<pre><code>make benchmarks    # compiles the program `libyelmo/bin/yelmo_benchmarks.x`
make mismip        # compiles the program `libyelmo/bin/yelmo_mismip.x`
make initmip       # compiles the program `libyelmo/bin/yelmo_initmip.x`
</code></pre>
<p>The Makefile additionally allows you to specify debugging compiler flags with the option <code>debug=1</code>, in case you need to debug the code (e.g., <code>make benchmarks debug=1</code>). Using this option, the code will run much slower, so this option is not recommended unless necessary.</p>
<h3 id="4-run-the-model">4. Run the model.</h3>
<p>Once an executable has been created, you can run the model. This can be
achieved via the included Python job submission script <code>runylmo</code>. The following steps
are carried out via the script:</p>
<ol>
<li>The output directory is created.</li>
<li>The executable is copied to the output directory</li>
<li>The relevant parameter files are copied to the output directory.</li>
<li>Links to the input data paths (<code>input</code> and <code>ice_data</code>) are created in the output directory. Note that many simulations, such as benchmark experiments, do not depend on these external data sources, but the links are made anyway.</li>
<li>The executable is run from the output directory, either as a background process or it is submitted to the queue via <code>sbatch</code> (the SLURM workload manager).</li>
</ol>
<p>To run a benchmark simulation, for example, use the following command:</p>
<pre><code>./runylmo -r -e benchmarks -o output/test -n par/yelmo_EISMINT.nml
</code></pre>
<p>where the option <code>-r</code> implies that the model should be run as a background process. If this is omitted, then the output directory will be populated, but no executable will be run, while <code>-s</code> instead will submit the simulation to cluster queue system instead of running in the background. The option <code>-e</code> lets you specify the executable. For some standard cases, shortcuts have been created:</p>
<pre><code>benchmarks = libyelmo/bin/yelmo_benchmarks.x
mismip     = libyelmo/bin/yemo_mismip.x
initmip    = libyelmo/bin/yelmo_initmip.x
</code></pre>
<p>The last two mandatory arguments <code>-o OUTDIR</code> and <code>-n PAR_PATH</code> are the output/run directory and the parameter file to be used for this simulation, respectively. In the case of the above simulation, the output directory is defined as <code>output/test</code>, where all model parameters (loaded from the file <code>par/yelmo_EISMINT.nml</code>) and model output can be found.</p>
<p>It is also possible to modify parameters inline via the option <code>-p KEY=VAL [KEY=VAL ...]</code>. The parameter should be specified with its namelist group and its name. E.g., to change the resolution of the EISMINT benchmark experiment to 10km, use:</p>
<pre><code>./runylmo -r -e benchmarks -o output/test -n par/yelmo_EISMINT.nml -p ctrl.dx=10
</code></pre>
<p>See <code>runylmo -h</code> for more details on the run script. </p>
<h2 id="test-cases">Test cases</h2>
<p>The published model description includes several test simulations for validation
of the model's performance. The following section describes how to perform these
tests using the same model version documented in the article. From this point,
it is assumed that the user has already configured the model for their system
(see https://palma-ice.github.io/yelmo-docs) and is ready to compile the mode.</p>
<h3 id="1-eismint1-moving-margin-experiment">1. EISMINT1 moving margin experiment</h3>
<p>To perform the moving margin experiment, compile the benchmarks
executable and call it with the EISMINT parameter file:</p>
<pre><code>make benchmarks
./runylmo -r -e benchmarks -o output/eismint-moving -n par-gmd/yelmo_EISMINT_moving.nml
</code></pre>
<h3 id="2-eismint2-expa">2. EISMINT2 EXPA</h3>
<p>To perform Experiment A from the EISMINT2 benchmarks, compile the benchmarks
executable and call it with the EXPA parameter file:</p>
<pre><code>make benchmarks
./runylmo -r -e benchmarks -o output/eismint-expa -n par-gmd/yelmo_EISMINT_expa.nml
</code></pre>
<h3 id="3-eismint2-expf">3. EISMINT2 EXPF</h3>
<p>To perform Experiment F from the EISMINT2 benchmarks, compile the benchmarks
executable and call it with the EXPF parameter file:</p>
<pre><code>make benchmarks
./runylmo -r -e benchmarks -o output/eismint-expf -n par-gmd/yelmo_EISMINT_expf.nml
</code></pre>
<h3 id="4-mismip-rf">4. MISMIP RF</h3>
<p>To perform the MISMIP rate factor experiment, compile the mismip executable
and call it with the MISMIP parameter file the three parameter permutations of interest (default, subgrid and subgrid+gl-scaling):</p>
<pre><code>make mismip
./runylmo -r -e mismip -o output/mismip-rf-0 -n par-gmd/yelmo_MISMIP3D.nml -p ydyn.beta_gl_stag=0 ydyn.beta_gl_scale=0
./runylmo -r -e mismip -o output/mismip-rf-1 -n par-gmd/yelmo_MISMIP3D.nml -p ydyn.beta_gl_stag=3 ydyn.beta_gl_scale=0
./runylmo -r -e mismip -o output/mismip-rf-2 -n par-gmd/yelmo_MISMIP3D.nml -p ydyn.beta_gl_stag=3 ydyn.beta_gl_scale=2
</code></pre>
<p>To additionally change the resolution of the simulations change the parameter <code>mismip.dx</code>, e.g. for the default simulation with 10km resolution , call:</p>
<pre><code>./runylmo -r -e mismip -o output/mismip-rf-0-10km -n par-gmd/yelmo_MISMIP3D.nml -p ydyn.beta_gl_stag=0 ydyn.beta_gl_scale=0 mismip.dx=10
</code></pre>
<h3 id="5-age-profile-experiments">5. Age profile experiments</h3>
<p>To perform the age profile experiments, compile the Fortran program <code>tests/test_icetemp.f90</code>
and run it:</p>
<pre><code>make icetemp
./libyelmo/bin/test_icetemp.x
</code></pre>
<p>To perform the different permutations, it is necessary to recompile for
single or double precision after changing the precision parameter <code>prec</code> in the file
<code>src/yelmo_defs.f90</code>. The number of vertical grid points can be specified in the main
program file, as well as the output filename.</p>
<h3 id="6-antarctica-present-day-and-glacial-simulations">6. Antarctica present-day and glacial simulations</h3>
<p>To perform the Antarctica simulations as presented in the paper, it is necessary
to compile the <code>initmip</code> executable and run with the present-day (pd) and
glacial (lgm) parameter values:</p>
<pre><code>make initmip
./runylmo -r -e initmip -o output/ant-pd -n par-gmd/yelmo_Antarctica.nml -p ctrl.clim_nm=&quot;clim_pd&quot;
./runylmo -r -e initmip -o output/ant-lgm -n par-gmd/yelmo_Antarctica.nml -p ctrl.clim_nm=&quot;clim_lgm&quot;
</code></pre>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../dependencies/" class="btn btn-neutral float-right" title="Dependencies">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href=".." class="btn btn-neutral" title="Home"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href=".." style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../dependencies/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme.js" defer></script>
      <script src="../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
